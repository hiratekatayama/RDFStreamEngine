- メイン

```java
	public static void main(String[] args) {
		try {
      // パラメータ設定
			Properties prop = new Properties();
			File in = new File("citybench.properties");
			FileInputStream fis = new FileInputStream(in);
			prop.load(fis);
			fis.close();
			HashMap<String, String> parameters = new HashMap<String, String>();
			for (String s : args) {
				parameters.put(s.split("=")[0], s.split("=")[1]);
			}
      // パラメータ登録
			CityBench cb = new CityBench(prop, parameters);
      // 重要：クエリ実行
			cb.startTest();
		} catch (IOException e) {
			e.printStackTrace();
			System.exit(0);
		} catch (Exception e) {
			e.printStackTrace();
			System.exit(0);
		}
	}
```

- startTest()

```java
	protected void startTest() throws Exception {
    //load queries from query directory
    // クエリロード
		this.loadQueries();
    // パフォーマンスのモニタリング
		pm = new PerformanceMonitor(queryMap, duration, queryDuplicates, resultName);
    // スレッドスタート
		new Thread(pm).start();
		if (this.engine == RSPEngine.cqels)
			// スタートCQELS
			this.initCQELS();
		else if (this.engine == RSPEngine.csparql)
      // スタートCSPARQL
			this.initCSPARQL();
  }
}
```

この3つを調べる

- loadQueries

  

- PerformanceMonitor

  

- initCQELS：CQELS実行

  ```java
  private void initCQELS() throws Exception {
     cqelsContext = tempContext;
  
     for (int i = 0; i < this.queryDuplicates; i++)
        this.registerCQELSQueries();
     // CQELS実行
     this.startCQELSStreams();
  }
  ```

  - startCQELSStreams

  ```java
  private void startCQELSStreams() throws Exception {
     for (String s : this.queryMap.values()) {
        // s: クエリ
        // クエリ実行
        this.startCQELSStreamsFromQuery(s);
     }
  
  }
  ```

  - startCQELSStreamsFromQuery

    CQELS エンジンがどこで実行されるのか確認する

  ```java
  private void startCQELSStreamsFromQuery(String query) throws Exception {
     List<String> streamNames = this.getStreamFileNamesFromQuery(query);
     for (String sn : streamNames) {
        String uri = RDFFileManager.defaultPrefix + sn.split("\\.")[0];
        String path = this.streams + "/" + sn;
        if (!this.startedStreams.contains(uri)) {
           this.startedStreams.add(uri);
           CQELSSensorStream css;
           EventDeclaration ed = er.getEds().get(uri);
           if (ed == null)
              throw new Exception("ED not found for: " + uri);
           if (ed.getEventType().contains("traffic")) {
              css = new CQELSAarhusTrafficStream(cqelsContext, uri, path, ed, start, end);
           } else if (ed.getEventType().contains("pollution")) {
              css = new CQELSAarhusPollutionStream(cqelsContext, uri, path, ed, start, end);
           } else if (ed.getEventType().contains("weather")) {
              css = new CQELSAarhusWeatherStream(cqelsContext, uri, path, ed, start, end);
           } else if (ed.getEventType().contains("location"))
              css = new CQELSLocationStream(cqelsContext, uri, path, ed);
           else if (ed.getEventType().contains("parking"))
              css = new CQELSAarhusParkingStream(cqelsContext, uri, path, ed, start, end);
           else
              throw new Exception("Sensor type not supported: " + ed.getEventType());
           css.setRate(this.rate);
           css.setFreq(this.frequency);
           new Thread(css).start();
           startedStreamObjects.add(css);
        }
     }
  
  }
  ```

  